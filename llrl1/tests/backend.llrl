(import "~/lowering/ir" _)
(import "~/backend/common/mem-layout" _)
(println! "llrl1/tests/backend")

(assert-eq? (class/merge class:void class:void) class:void)
(assert-eq? (class/merge class:void class:floating-point) class:floating-point)
(assert-eq? (class/merge class:floating-point class:floating-point) class:floating-point)
(assert-eq? (class/merge class:integer class:floating-point) class:integer)
(assert-eq? (class/merge class:integer class:memory) class:memory)
(assert-eq? (class/merge class:memory class:floating-point) class:memory)

(assert-eq?
  (layout/product (array
    (: (ct:s 32) (layout/terminal 4 4 class:integer))
    (: (ct:u 8) (layout/terminal 1 1 class:integer))
    (: (ct:u 16) (layout/terminal 2 2 class:integer))
    (: (ct:s 64) (layout/terminal 8 8 class:integer))))
  (layout: 16 8 class:integer (array
    (layout-component: 0 (ct:s 32))
    (layout-component: 4 (ct:u 8))
    (layout-component: 6 (ct:u 16))
    (layout-component: 8 (ct:s 64)))))

(assert-eq?
  (layout/sum (array
    (layout/terminal 12 4 class:integer)
    (layout/terminal 20 2 class:memory)
    (layout/terminal 8 8 class:integer)))
  (layout/terminal 24 8 class:memory))
